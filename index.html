<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sound Level Meter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/addons/p5.sound.min.js"></script>
  </head>
  <body>
  <script>
    var mic;
    let canvasWidth = 400;
    let canvasHeight = 300;
    let margin = 10;

    let lampCount = 20;
    let lampSize = (canvasWidth - margin * 2) / lampCount;

    function setup() {
      createCanvas(canvasWidth, canvasHeight);

      noStroke();
      colorMode(HSB);

      mic = new p5.AudioIn();
      mic.start();
    }

    let safeLamp = 125;
    let warnLamp = 0;
    let highBright = 100;
    let lowBright = 20;
    let 

    function draw() {
      background(0);

      let vol = mic.getLevel() * lampCount;
      let onLampCount = Math.floor(vol);
      let fraction = vol - maxLampCount;

      var brights = Array(onLampCount).fill(highBright)
        .concat([fraction])
        .concat(Array(onLampCount - lampCount).fill(lowBright));

      var x = margin - (lampSize / 2);
      brights.forEach( (v, i) => {
        fill((i < Math.floor(vol * 0.8) ? safeLamp : warnLamp), 100, v);
        x = x + lampSize;
        let y = canvasHeight / 2;
        ellipse(x, y, lampSize, lampSize);
      });
    }
  </script>
  </body>
</html>
